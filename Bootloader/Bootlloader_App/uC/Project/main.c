#include "main.h"
#include "Flowcontrol.h"

static uint32_t Boot_or_App;
static char a[] ={0x7B,0xD3,0xF7,0xE1,0x00,0x00,0x08,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x16,0x7D};
static char b[] = {0x7B,0xB3,0x15,0xFD,0x08,0x00,0x60,0x00,0xA1,0xA1,0xA1,0xA1,0x00,0x60,0x00,0x08,0x00,0x00,0x01,0x08,0x00,0x00,0x00,0x00,0xA6,0x7D};
void delay();

void Gpio_init();
void comif(char arr[]);
int main()
{
	FCControl_ST *fcmge = &FCManage;
	Init();
	Gpio_init();
	bkSRAM_ReadVariable(BkUpRam_Verify_App_ADD,&Boot_or_App);
	
	
	if(Boot_or_App == 0x0B0B0B0B)
	{
		//Debug_SendString("vfy_bkp");
		Boot_TxByte_ST *Tx = &Boot_Tx_Data;
		Tx->Boot_Status =0x0C;
		Boot_Res_Status();
		bkSRAM_WriteVariable(BkUpRam_Verify_App_ADD,BkupRam_ADD_Clear);
	}
	fcmge->FCFlag.FCInitialFlag = TRUE;
//	while(FCData_Transmit(0x08012000) != 1);
//	comif(a);
	while(1)
	{
		delay();
		USART3_Main();
		Boot_Main();
		Debug_MainFunction();
		delay();
	}
}

void Gpio_init(void)
{
	GPIO_InitTypeDef PA1 ={0};
	/* For Check the Pin to move bootloader or App */
	HAL_GPIO_WritePin(GPIOA,GPIO_PIN_1,GPIO_PIN_RESET);
	
	PA1.Pin = GPIO_PIN_1;
	PA1.Mode = GPIO_MODE_OUTPUT_PP;
	PA1.Pull = GPIO_NOPULL;
	PA1.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(GPIOA,&PA1);
	
}

void comif(char arr[])
{
		for(int i=0;i<252;i++) 
	{ ComIf_RxIndication_Boot(arr[i]);}
}

#include "Ports_init.h"
#include "NvmNvs_state_Handling.h"
static uint32_t Boot_or_App;
char a[] ={0x7B ,0xD3 ,0xF7 ,0x11 ,0x20 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x55 ,0x55 ,0xEE ,0xEF ,0xAA ,0xAA ,0x11 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x01 ,0x55 ,0x55 ,0xDD ,0xDE ,0xAA ,0xAA ,0x22 ,0x22 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x02 ,0x55 ,0x55 ,0xEE ,0xEF ,0xAA ,0xAA ,0x11 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x03 ,0x55 ,0x55 ,0xDD ,0xDE ,0xAA ,0xAA ,0x22 ,0x22 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x04 ,0x55 ,0x55 ,0xEE ,0xEF ,0xAA ,0xAA ,0x11 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x05 ,0x55 ,0x55 ,0xDD ,0xDE ,0xAA ,0xAA ,0x22 ,0x22 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x06 ,0x55 ,0x55 ,0xEE ,0xEF ,0xAA ,0xAA ,0x11 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x07 ,0x55 ,0x55 ,0xDD ,0xDE ,0x23 ,0x7D};
static char b[] ={0x7B ,0xD3 ,0x23 ,0xE2 ,0x20 ,0x00 ,0xA1 ,0xA1 ,0xA1 ,0xA1 ,0x00 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x08 ,0x55 ,0x55 ,0xEE ,0xEF ,0xAA ,0xAA ,0x11 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x71 ,0x7D};
char c[] = {0x7B ,0xD3 ,0x07 ,0xD0 ,0x00 ,0x00 ,0x08 ,0x00 ,0x60 ,0x00 ,0xC8 ,0x7D}; // read version
char d[] = {0x7B ,0xD3 ,0x2F ,0x00 ,0x2C ,0x00 ,0xC1 ,0xC1 ,0xC1 ,0xC1 ,0x00 ,0x20 ,0x00 ,0x00 ,0xD6 ,0xDD ,0x89 ,0x0E ,0x60 ,0x06 ,0x00 ,0x20 ,0xDD ,0x32 ,0x00 ,0x08 ,0xE5 ,0x32 ,0x00 ,0x08 ,0xE7 ,0x32 ,0x00 ,0x08 ,0x78 ,0xC1 ,0xFB ,0xD8 ,0x52 ,0x07 ,0x28 ,0xBF ,0x30 ,0xC1 ,0x48 ,0xBF ,0x0B ,0x60 ,0x70 ,0x47 ,0x23 ,0x7D};
void delay();
void comif(char arr[]);
void Gpio_init();   //E1+00+00+08+01+20+00

int main()
{
	Init();
	Gpio_init();
	bkSRAM_ReadVariable(BkUpRam_Verify_App_ADD,&Boot_or_App);
	
//	uint32_t NVSadd = find_NvsLastAddress();
//	if(Boot_or_App == 0x0B0B0B0B)
//	{
//		//Debug_SendString("vfy_bkp");
//		Boot_TxByte_ST *Tx = &Boot_Tx_Data;
//		Tx->Boot_Status =0x0C;
//		BOOT_RES_STATUS();
//		bkSRAM_WriteVariable(BkUpRam_Verify_App_ADD,BkupRam_ADD_Clear);
//	}
		
//	comif(c);
	while(1)
	{
		delay();
		USART3_Main();
		Boot_Main();
		NVM_NVS_Main();
		Debug_MainFunction();
		delay();
	}
}

void Gpio_init(void)
{
	GPIO_InitTypeDef PA1 ={0};
	/* For Check the Pin to move bootloader or App */
	HAL_GPIO_WritePin(GPIOA,GPIO_PIN_1,GPIO_PIN_RESET);
	
	PA1.Pin = GPIO_PIN_1;
	PA1.Mode = GPIO_MODE_OUTPUT_PP;
	PA1.Pull = GPIO_NOPULL;
	PA1.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(GPIOA,&PA1);
	
}

void comif(char arr[])
{
		for(int i=0;i<252;i++) 
	{ ComIf_RxIndication_Boot(arr[i]);}
}
